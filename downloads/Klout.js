{"files":[{"id":"3c51d14e-d302-4081-8ec8-771d613e1aec","name":"main","type":"server_js","source":"var rankingNamen \u003d [];\nvar rankingScores \u003d [];\n\nfunction main() {\n    var DATA \u003d \u00271pmACeyLC_PLLEKxS_7e4rqHKrpjgvkrTRAz7eWG2mxg\u0027;\n    var data \u003d SpreadsheetApp.openById(DATA);\n\n    var BUFFER \u003d data.getSheets()[0];\n    var FaceRepo_META \u003d data.getSheets()[1];\n    var FaceRepo_RAW \u003d data.getSheets()[2];\n\n    var RAW \u003d FaceRepo_RAW;\n    var META \u003d FaceRepo_META;\n\n    var STARTDATUM \u003d new Date(\"May 14, 2016 0:00:00\");\n    var progstart \u003d new Date();\n    var timezone \u003d \u0027GMT\u0027;\n\n    var date \u003d Utilities.formatDate(progstart, timezone, \u0027dd-MM-yyyy\u0027);\n    var row \u003d TimeFunctions.dayDiff(STARTDATUM, progstart) + 1;\n\n    var i \u003d 1;\n\n    // TODO only one getvalue per entry\n    while (SheetAccess.getValue(0, i, RAW) !\u003d undefined) {\n        updateRaw(RAW, META, BUFFER, row, i, date);\n        i +\u003d 1;\n    }\n    // TODO BUBBLESORT (before update chart legend)\n    for (var j \u003d 1; j \u003c i; j++) {\n        updateChartLegend(RAW, row, j);\n    }\n\n    SheetAccess.setValue(row, 0, RAW, date);\n    SheetAccess.setValue(0, 1, META, Utilities.formatDate(new Date(), timezone,\n        \"yyyy-MM-dd\u0027 at \u0027HH:mm:ss\u0027 (\" + timezone + \")\u0027\"));\n}\n//TEST\n"},{"id":"025abd6d-d442-4872-b8ea-d17247fe3a5d","name":"updateChartLegend","type":"server_js","source":"function updateChartLegend(RAW, row, kolom) {\n\n    // RAW\n    var waarde \u003d SheetAccess.getValue(row, kolom, RAW);\n    var naam \u003d SheetAccess.getValue(0, kolom, RAW);\n    SheetAccess.setValue(1, kolom, RAW, \u0027[\u0027 + kolom + \u0027] \u0027 + naam + \u0027 (\u0027 +\n        waarde + \u0027)\u0027);\n}\n"},{"id":"c52a36d7-318c-4b04-94e4-f1ff05861cdb","name":"updateRaw","type":"server_js","source":"function updateRaw(RAW, META, BUFFER, row, kolom, date) {\n    var index \u003d kolom;\n    var user \u003d SheetAccess.getValue(0, kolom, RAW);\n    var score \u003d getKloutScore(user, BUFFER);\n\n    // zet score op juiste plaats in RAW\n    SheetAccess.setValue(row, kolom, RAW, score);\n\n    // laten weten via IFTTT\n    if (user \u003d\u003d \u0027mdsnouck\u0027) {\n        updateAndNotify(1, 1, META, score, \u0027mdsnouck\u0027);\n    } else if (user \u003d\u003d \u0027VTKGent\u0027) {\n        updateAndNotify(2, 1, META, score, \u0027VTKGent\u0027);\n    }\n}\n"},{"id":"9ff614b3-87a4-443a-a1df-3225a314b0a6","name":"getKloutScore","type":"server_js","source":"function getKloutScore(user, BUFFER) {\n    var apikey \u003d \u00275vwvv52dxujawj6hzfyhsbue\u0027;\n    var data \u003d JSON.parse(Web.getHTML(\n        \u0027http://api.klout.com/v2/identity.json/twitter?screenName\u003d\u0027 + user +\n        \u0027\u0026key\u003d\u0027 + apikey, BUFFER));\n    var score \u003d JSON.parse(Web.getHTML(\u0027http://api.klout.com/v2/user.json/\u0027 +\n        data.id + \u0027/score?key\u003d\u0027 + apikey, BUFFER));\n\n    return score.score;\n}\n"},{"id":"620f128f-ce04-4c16-bc07-57ead5d98e80","name":"updateAndNotify","type":"server_js","source":"function updateAndNotify(row, kolom, META, score, user) {\n    var old \u003d SheetAccess.getValue(row, kolom, META);\n    var scorefloor \u003d Math.floor((score) * 100) / 100;\n    var oldfloor \u003d Math.floor((old) * 100) / 100;\n    var diff \u003d Math.floor((scorefloor - oldfloor) * 100) / 100;\n    var diffFull \u003d score - old\n\n    if (Math.abs(diffFull) \u003e 0) {\n        SheetAccess.setValue(row, kolom, META, score);\n        score \u003d Math.floor(score * 100) / 100;\n        if (diff \u003c 0) {\n            var body \u003d \u0027KLOUT \u0027 + user + \u0027 is now \u0027 + scorefloor + \u0027 [\u0027 + diff +\n                \u0027]\u0027;\n        } else if (diff \u003e 0) {\n            body \u003d \u0027KLOUT \u0027 + user + \u0027 is now \u0027 + scorefloor + \u0027 [+\u0027 + diff +\n                \u0027]\u0027;\n        } else {\n            body \u003d \u0027KLOUT \u0027 + user + \u0027 is now \u0027 + scorefloor + \u0027 [no change]\u0027;\n        }\n        var subject \u003d \u0027##IFTTTnotification\u0027;\n        var recipient \u003d \u0027trigger@recipe.ifttt.com\u0027;\n\n        MailApp.sendEmail(recipient, subject, body);\n    }\n}\n"},{"id":"79309909-e480-4b8d-a0f5-99d2264a8c82","name":"sortColumns","type":"server_js","source":"function sortColumns() {\n\n}\n"}]}